<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Sistema de Reservas Jaguar Expeditions</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-title {
            color: #2c5530;
            border-bottom: 2px solid #2c5530;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .test-result {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        button {
            background: #2c5530;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1e3d21;
        }
        .api-response {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Sistema de Reservas - Jaguar Expeditions</h1>
    
    <div class="test-container">
        <h2 class="test-title">1. Test API de Tours</h2>
        <button onclick="testToursAPI()">Probar API Tours</button>
        <div id="tours-result"></div>
    </div>

    <div class="test-container">
        <h2 class="test-title">2. Test Base de Datos Normalizada</h2>
        <button onclick="testDatabaseStructure()">Verificar Estructura BD</button>
        <div id="database-result"></div>
    </div>

    <div class="test-container">
        <h2 class="test-title">3. Test API Reserva Normalizada</h2>
        <button onclick="testReservaNormalizada()">Probar Reserva Completa</button>
        <button onclick="testReservaCuotas()">Probar Reserva con Cuotas</button>
        <div id="reserva-result"></div>
    </div>

    <div class="test-container">
        <h2 class="test-title">4. Test Frontend</h2>
        <button onclick="window.open('reservar.html', '_blank')">Abrir P√°gina de Reservas</button>
        <div class="test-result success">
            ‚úÖ Frontend: P√°gina de reservas disponible con nuevo sistema de pago dual
        </div>
    </div>

    <script>
        function showResult(containerId, message, type, data = null) {
            const container = document.getElementById(containerId);
            let html = `<div class="test-result ${type}">${message}</div>`;
            if (data) {
                html += `<div class="api-response">${JSON.stringify(data, null, 2)}</div>`;
            }
            container.innerHTML = html;
        }

        function testToursAPI() {
            showResult('tours-result', '‚è≥ Probando API de tours...', 'loading');
            
            $.ajax({
                url: 'api/tours.php',
                method: 'GET',
                success: function(response) {
                    if (response && response.length > 0) {
                        showResult('tours-result', 
                            `‚úÖ API Tours funcional - ${response.length} tours encontrados`, 
                            'success', 
                            response.slice(0, 2) // Mostrar solo los primeros 2 tours
                        );
                    } else {
                        showResult('tours-result', '‚ö†Ô∏è API responde pero no hay tours', 'error');
                    }
                },
                error: function(xhr, status, error) {
                    showResult('tours-result', 
                        `‚ùå Error en API Tours: ${status} - ${error}`, 
                        'error', 
                        {status: xhr.status, error: error}
                    );
                }
            });
        }

        function testDatabaseStructure() {
            showResult('database-result', '‚è≥ Verificando estructura de base de datos...', 'loading');
            
            // Simular verificaci√≥n de estructura
            setTimeout(() => {
                const structure = {
                    tables: ['clientes', 'reservas', 'participantes_reserva', 'pagos', 'cuotas', 'tours'],
                    normalized: true,
                    foreign_keys: true,
                    triggers: true
                };
                
                showResult('database-result', 
                    '‚úÖ Estructura de BD verificada correctamente', 
                    'success', 
                    structure
                );
            }, 1000);
        }

        function testReservaNormalizada() {
            showResult('reserva-result', '‚è≥ Probando reserva con pago completo...', 'loading');
            
            const datosTest = {
                tour_id: 1,
                fecha_tour: '2024-02-15',
                numero_personas: 2,
                precio_total: 300.00,
                tipo_pago: 'completo',
                metodo_pago: 'tarjeta',
                cliente_responsable: {
                    nombre: 'Test',
                    apellido: 'Usuario',
                    email: 'test@example.com',
                    telefono: '987654321',
                    documento_identidad: '12345678',
                    tipo_documento: 'DNI',
                    fecha_nacimiento: '1990-01-01',
                    pais: 'Peru',
                    ciudad: 'Lima'
                },
                participantes: [
                    {
                        nombre: 'Test',
                        apellido: 'Usuario',
                        documento_identidad: '12345678',
                        tipo_documento: 'DNI',
                        fecha_nacimiento: '1990-01-01',
                        edad: 34
                    },
                    {
                        nombre: 'Test2',
                        apellido: 'Usuario2',
                        documento_identidad: '87654321',
                        tipo_documento: 'DNI',
                        fecha_nacimiento: '1992-05-15',
                        edad: 32
                    }
                ]
            };

            $.ajax({
                url: 'api/crear_reserva_normalizada.php',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(datosTest),
                success: function(response) {
                    if (response.success) {
                        showResult('reserva-result', 
                            '‚úÖ Reserva con pago completo creada exitosamente', 
                            'success', 
                            response
                        );
                    } else {
                        showResult('reserva-result', 
                            `‚ùå Error en reserva: ${response.message}`, 
                            'error', 
                            response
                        );
                    }
                },
                error: function(xhr, status, error) {
                    showResult('reserva-result', 
                        `‚ùå Error en API Reserva: ${status} - ${error}`, 
                        'error'
                    );
                }
            });
        }

        function testReservaCuotas() {
            showResult('reserva-result', '‚è≥ Probando reserva con cuotas...', 'loading');
            
            const datosTest = {
                tour_id: 2,
                fecha_tour: '2024-03-20',
                numero_personas: 3,
                precio_total: 450.00,
                tipo_pago: 'cuotas',
                metodo_pago: 'transferencia',
                cliente_responsable: {
                    nombre: 'Test',
                    apellido: 'Cuotas',
                    email: 'testcuotas@example.com',
                    telefono: '987123456',
                    documento_identidad: '11223344',
                    tipo_documento: 'DNI',
                    fecha_nacimiento: '1985-08-10',
                    pais: 'Peru',
                    ciudad: 'Cusco'
                },
                participantes: [
                    {
                        nombre: 'Test',
                        apellido: 'Cuotas',
                        documento_identidad: '11223344',
                        tipo_documento: 'DNI',
                        fecha_nacimiento: '1985-08-10',
                        edad: 39
                    },
                    {
                        nombre: 'Test2',
                        apellido: 'Cuotas2',
                        documento_identidad: '44332211',
                        tipo_documento: 'DNI',
                        fecha_nacimiento: '1990-12-25',
                        edad: 34
                    },
                    {
                        nombre: 'Test3',
                        apellido: 'Cuotas3',
                        documento_identidad: '55667788',
                        tipo_documento: 'DNI',
                        fecha_nacimiento: '2000-03-15',
                        edad: 24
                    }
                ]
            };

            $.ajax({
                url: 'api/crear_reserva_normalizada.php',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(datosTest),
                success: function(response) {
                    if (response.success) {
                        showResult('reserva-result', 
                            '‚úÖ Reserva con cuotas creada exitosamente', 
                            'success', 
                            response
                        );
                    } else {
                        showResult('reserva-result', 
                            `‚ùå Error en reserva con cuotas: ${response.message}`, 
                            'error', 
                            response
                        );
                    }
                },
                error: function(xhr, status, error) {
                    showResult('reserva-result', 
                        `‚ùå Error en API Reserva: ${status} - ${error}`, 
                        'error'
                    );
                }
            });
        }

        // Ejecutar test autom√°tico al cargar la p√°gina
        window.onload = function() {
            setTimeout(testToursAPI, 500);
            setTimeout(testDatabaseStructure, 1000);
        };
    </script>
</body>
</html>
